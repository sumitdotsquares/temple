#!/usr/bin/perl

use strict;
use CGI qw/:all/;
use URI;

my $docroot = $ENV{'DOCUMENT_ROOT'};

chomp(my $year = `/bin/date +%Y`);

my $html = getvalue($docroot . '/includes/html/footer.html');

$html =~ s/YEAR/$year/s;

# extract selection on main navbar
my $uri = URI->new($ENV{'REQUEST_URI'},'https');
my $uri = $uri->path();
$uri =~ s/%([0-9A-Fa-f]{2})/chr(hex($1))/eg;

$uri =~ /^\/(.*?)(\/|$)/;
my $activated = $1;

my $js;


if ($uri eq '/research/gs/') { $js = 'gs.js'; }
elsif ($uri eq '/') { $js = 'events.js'; }
elsif ($uri =~ /syllabi/) { $js = 'syllabi.js'; }
elsif ($uri =~ /get_your_grade/) { $js = 'getyourgrade.js'; }
elsif ($uri =~ /join/) { $js = 'join.js'; }
elsif ($uri =~ /skday/) { $js = 'skday.js'; }
elsif ($uri =~ /contact/) { $js = 'contact.js'; }
elsif ($uri =~ /directory/) { $js = 'directory.js'; }
elsif ($uri =~ /people/) { $js = 'people.js'; }
elsif ($uri =~ /research/) { $js = 'research.js'; }
elsif ($uri =~ /backup/) { $js = 'backup.js'; }
elsif ($uri =~ /access/) { $js = 'access.js'; }
else { $js = ''; }

if ($js) { $js = qq(<script src="/includes/js/) . $js . qq("></script>); }

chomp(my $research = `/usr/bin/perl $docroot/cgi-bin/get_researcharea_list`);

$html =~ s/JAVASCRIPT/$js/;
$html =~ s/RESEARCHAREAS/$research/;

# closing div tag corresponds to <div id="content-overview">
# generated by get_header
print header; 

if ($uri ne '/') { print "</div>\n\n";  }

print $html;


sub getvalue {
	my $file = $_[0];
	return unless (-e $file);
	open FILE, '<', $file;
	my @lines = <FILE>;
	close FILE;
	my $output = join "", @lines;
	return $output;
}
